<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>

<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  <!-- To convert markdown content to html -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>

  <script>
    CMS.registerPreviewStyle("./cms/example.css");
    const converter = new showdown.Converter()

    const PostPreview = createClass({
      render: function () {
        const entry = this.props.entry;
        const entryData = entry.getIn(["data"]).toJS()
        // console.log('ðŸ’œentryData:', entryData);
        
        let title = entry.getIn(['data', 'title']);
        const image = entry.getIn(['data', 'image']);
        let imageAlt = entry.getIn(['data', 'imageAlt']);
        let body = h('div', { "className": "text" }, this.props.widgetFor('body'));

        let bodyMarkdown = entry.getIn(["data"]).toJS().body;
        const bodyHtml = converter.makeHtml(bodyMarkdown);

        let htmlBfBody =
          `<main>
            <article class="main-article">
              <div class="container container--narrow flow">

              <h1 class="article-title">
                ${title}
              </h1>
              <figure class="main-article__figure">
                <img src="${image}" alt="${imageAlt}">
              <figcaption>`

        let htmlAfBody = 
                  `</figcaption>
                </figure>

              </div>
            </article>
          </main>`

        return h('div', {
          dangerouslySetInnerHTML: { __html: htmlBfBody + bodyHtml + htmlAfBody },
        })
      }
    });

    CMS.registerPreviewTemplate("blog", PostPreview);
  </script>
</body>

</html>